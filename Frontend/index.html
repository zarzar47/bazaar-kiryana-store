<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kiryana Store API Tester</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2rem auto; }
    input, button { margin: 0.2rem; padding: 0.5rem; }
    textarea { width: 100%; height: 200px; margin-top: 1rem; font-family: monospace; }
  </style>
</head>
<body>
  <h2>Kiryana Store API Tester</h2>

  <label>Username: <input id="username" value="admin"></label><br>
  <label>Password: <input id="password" value="password"></label><br>

  <button onclick="callAPI('GET', '/api/products')">Get Products</button>
  <button onclick="callAPI('GET', '/api/products/movement/101')">Get Product Movement</button>

  <button onclick="callAPI('POST', '/api/products/removeProd', {
    product_id: 160,
    irrelevant: 1
  })">Remove Product</button>

  <button onclick="callAPI('POST', '/api/products/addProd', {
    storeID: 1,
    product_id: 160,
    ItemQuantity: 130,
    price_per_unit: 13.5,
    itemDesc: 'Plum 500g',
    stocked_in: '2024-01-11',
    VendorId: 2
  })">Add Product</button>

  <button onclick="callAPI('POST', '/api/products/sale', {
    store_id: 1,
    product_id: 101,
    state: 'sale',
    quantity: 10
  })">Sale</button>

  <button onclick="callAPI('POST', '/api/products/manual-removal')">Immediate Remove</button>
  <button onclick="callAPI('POST', '/api/products/stock-in')">Stock In</button>

  <h4>Response:</h4>
  <textarea id="response" readonly></textarea>

  <script>
    const API_BASE = 'http://localhost:5000';

    async function callAPI(method, endpoint, body = null) {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const credentials = btoa(`${username}:${password}`);
      console.log(`Calling ${method} ${API_BASE + endpoint} with body:`, credentials);
      const headers = {
        'Authorization': `Basic ${credentials}`
      };

      if (body) {
        headers['Content-Type'] = 'application/json';
      }

      try {
        const res = await fetch(API_BASE + endpoint, {
          method,
          headers,
          body: body ? JSON.stringify(body) : undefined
        });

        const text = await res.text();
        document.getElementById('response').value = text;
      } catch (err) {
        document.getElementById('response').value = 'Error: ' + err.message;
      }
    }
  </script>
</body>
</html>
